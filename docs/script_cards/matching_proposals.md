# matching_proposals â€” Script Card

## Identity
- job_id: matching_proposals
- glue_job_name: TBD
- runtime: pyspark
- repo_path: jobs/vendor_input_processing/matching_proposals/glue_script.py
- manifest_path: jobs/vendor_input_processing/matching_proposals/job_manifest.yaml

## Purpose
- Generates JSON outputs for matching proposals and a derived subset, writing results to configured S3 locations.

## Trigger and Orchestration
- Triggered by: TBD
- Required parameters: JOB_NAME, INPUT_BUCKET, OUTPUT_BUCKET, vendor_name, prepared_input_key, prepared_output_prefix
- Preconditions: TBD

## Inputs
- Input 1:
  - bucket: ${INPUT_BUCKET}
  - key_pattern: TBD
  - format: json
  - required: TBD
  - meaning: TBD

## Outputs
- Output 1:
  - bucket: ${OUTPUT_BUCKET}
  - key_pattern: ${prepared_output_prefix}/${vendor_name}_categoryMatchingProposals.json
  - format: json
  - required: TBD
  - meaning: JSON output generated by the job.
  - consumers: TBD
- Output 2:
  - bucket: ${OUTPUT_BUCKET}
  - key_pattern: ${prepared_output_prefix}/${vendor_name}_categoryMatchingProposals_oneVendor_to_onePim_match.json
  - format: json
  - required: TBD
  - meaning: Subset JSON output derived by the job.
  - consumers: TBD

## Side Effects
- deletes_inputs: TBD
- overwrites_outputs: TBD
- other_side_effects: TBD

## High-level Processing (Factual)
- Resolve Glue job parameters and initialize Spark/Glue contexts.
- Read input JSON data from S3.
- Validate expected mapping data and handle empty or missing cases.
- Aggregate vendor category data with PIM category match information.
- Write the main proposal output to S3.
- Derive and write a subset output with additional filtering.

## Invariants (As Implemented Today)
- TBD

## Failure Modes and Observability
- Failure conditions (as coded): Glue argument parsing failures; S3 read/write errors; Spark JSON read failures beyond fallback; unhandled exceptions during processing.
- Logging/metrics (as coded): Glue logger info/warn/error messages and print-based DEBUG statements.
- Run receipt: TBD
- Operator checks (S3 artifacts to verify): Verify presence of the two output objects defined in the manifest under ${OUTPUT_BUCKET}.

## Related Artifacts and References
- job_manifest: jobs/vendor_input_processing/matching_proposals/job_manifest.yaml
- artifacts_catalog entries: TBD
- upstream jobs: TBD
- downstream jobs: TBD
