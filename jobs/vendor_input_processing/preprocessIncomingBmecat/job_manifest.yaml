job_id: preprocessIncomingBmecat
glue_job_name: preprocessIncomingBmecat
runtime: python_shell
entrypoint: glue_script.py

parameters:
  - JOB_NAME
  - INPUT_BUCKET
  - OUTPUT_BUCKET
  - vendor_name
  - bmecat_input_key
  - bmecat_output_prefix

inputs:
  - bucket: ${INPUT_BUCKET}
    key_pattern: ${bmecat_input_key}
    format: xml
    required: true

outputs:
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_vendor_products.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_features.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_category_links.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_mimes.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_relations.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_prices.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_vendor_categories.json
    format: ndjson
    required: false

config_files:
  - bucket: ${INPUT_BUCKET}
    key_pattern: configuration-files/incomingVendorBmecatPreprocessing_configs/incomingVendorBmecatPreprocessing_config_${vendor_name}.json
    format: json
    required: true
    repo_path: null

side_effects:
  deletes_inputs: false
  overwrites_outputs: true

logging_and_receipt:
  writes_run_receipt: false
  run_receipt_bucket: null
  run_receipt_key_pattern: null
  counters_observed: []

notes:
  - "Evidence source: Analyzed glue_script.py lines 1-979, checked getResolvedOptions REQUIRED_ARGS (lines 11-19), S3 I/O patterns (lines 50-979), and output writes via write_ndjson_to_s3 helper."
  - "bmecat_output_prefix normalization: Script normalizes prefix by ensuring trailing slash (lines 35-36), so manifest uses ${bmecat_output_prefix_norm} placeholder."
  - "Script does not write run receipt file to S3 (only logs summary to stdout, lines 957-979). No structured counters emitted to CloudWatch."
  - "Config file exists in S3 only (configuration-files/incomingVendorBmecatPreprocessing_configs/), not mirrored in repository (verified: not in jobs/*/config/ or config/ directories)."
