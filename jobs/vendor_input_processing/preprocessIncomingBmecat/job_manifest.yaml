schema_version: "1.0"
job_id: preprocessIncomingBmecat
glue_job_name: TBD
runtime: python_shell
entrypoint: glue_script.py

parameters:
  - JOB_NAME
  - INPUT_BUCKET
  - OUTPUT_BUCKET
  - vendor_name
  - bmecat_input_key
  - bmecat_output_prefix

inputs:
  - bucket: ${INPUT_BUCKET}
    key_pattern: ${bmecat_input_key}
    format: xml
    required: true

outputs:
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_vendor_products.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_features.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_category_links.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_mimes.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_relations.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_product_prices.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix_norm}${vendor_name}_vendor_categories.json
    format: ndjson
    required: false

config_files:
  - bucket: ${INPUT_BUCKET}
    key_pattern: configuration-files/incomingVendorBmecatPreprocessing_configs/incomingVendorBmecatPreprocessing_config_${vendor_name}.json
    format: json
    required: true
    repo_path: TBD

side_effects:
  deletes_inputs: false
  overwrites_outputs: true

logging_and_receipt:
  writes_run_receipt: false
  run_receipt_bucket: TBD
  run_receipt_key_pattern: TBD
  counters_observed: TBD

notes:
  - "TBD_EXPLANATIONS:"
  - "glue_job_name: TBD — Not yet deployed to AWS Glue (no deployment config found in repo). Needs deployment config from DevOps team."
  - "config_files[0].repo_path: TBD — Config file exists in S3 at configuration-files/incomingVendorBmecatPreprocessing_configs/ but not mirrored in repository. Team to decide if repo mirror is needed."
  - "logging_and_receipt.run_receipt_bucket: TBD — Script does not write a run receipt file to S3 (only logs summary to stdout, lines 957-979 in glue_script.py). If future implementation adds S3 receipt, this field should be updated."
  - "logging_and_receipt.run_receipt_key_pattern: TBD — Script does not write a run receipt file to S3. See run_receipt_bucket explanation."
  - "logging_and_receipt.counters_observed: TBD — Script logs record counts to stdout but does not emit structured counters to CloudWatch or a receipt file. Need to review job execution logs to identify emitted metrics."
  - "Evidence source: Analyzed glue_script.py lines 1-979, checked getResolvedOptions REQUIRED_ARGS (lines 11-19), S3 I/O patterns (lines 50-979), and output writes via write_ndjson_to_s3 helper."
  - "bmecat_output_prefix normalization: Script normalizes prefix by ensuring trailing slash (line 31-32), so manifest uses ${bmecat_output_prefix_norm} placeholder."
