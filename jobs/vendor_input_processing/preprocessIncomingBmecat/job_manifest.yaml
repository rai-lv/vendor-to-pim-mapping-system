job_id: preprocessIncomingBmecat
glue_job_name: TBD
runtime: python_shell
entrypoint: glue_script.py

parameters:
  - JOB_NAME
  - INPUT_BUCKET
  - OUTPUT_BUCKET
  - vendor_name
  - bmecat_input_key
  - bmecat_output_prefix

inputs:
  - bucket: ${INPUT_BUCKET}
    key_pattern: ${bmecat_input_key}
    format: xml
    required: true

outputs:
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix}${vendor_name}_vendor_products.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix}${vendor_name}_product_features.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix}${vendor_name}_product_category_links.json
    format: ndjson
    required: true
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix}${vendor_name}_product_mimes.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix}${vendor_name}_product_relations.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix}${vendor_name}_product_prices.json
    format: ndjson
    required: false
  - bucket: ${OUTPUT_BUCKET}
    key_pattern: ${bmecat_output_prefix}${vendor_name}_vendor_categories.json
    format: ndjson
    required: false

config_files:
  - repo_path: TBD
    s3_bucket: ${INPUT_BUCKET}
    s3_key_pattern: configuration-files/incomingVendorBmecatPreprocessing_configs/incomingVendorBmecatPreprocessing_config_${vendor_name}.json
    required: true

side_effects:
  deletes_inputs: false
  overwrites_outputs: true

logging_and_receipt:
  writes_run_receipt: false
  run_receipt_bucket: TBD
  run_receipt_key_pattern: TBD
  counters_observed:
    - vendor_products
    - product_features
    - product_mimes
    - product_relations
    - product_category_links
    - product_prices
    - vendor_categories
    - skipped_articles_no_id

notes:
  - "Phase 1 reverse-documentation: derived only from TARGET_SCRIPT; unknowns are marked TBD."
  - "TBD_EXPLANATIONS: (auto-filled list below)"
  - "glue_job_name: TBD — no Glue job name is declared in TARGET_SCRIPT."
  - "config_files[0].repo_path: TBD — TARGET_SCRIPT does not reference a repo path for the config file."
  - "logging_and_receipt.run_receipt_bucket: TBD — TARGET_SCRIPT does not write a run receipt to S3."
  - "logging_and_receipt.run_receipt_key_pattern: TBD — TARGET_SCRIPT does not write a run receipt to S3."
